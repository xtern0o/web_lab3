<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="layout/template.xhtml">

    <ui:define name="title">Форма</ui:define>

    <ui:define name="content">

        <style type="text/css">
            #map-canvas {
                background-image: url("#{resource['img/worldMap.jpg']}");
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                background-color: white;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            #map-canvas:hover {
                box-shadow: 0 8px 25px rgba(120, 0, 0, 0.3);
            }
        </style>

        <div class="grid-container">
            <div class="map-container">
                <h1>Map</h1>
                <div id="canvas-wrapper" class="canvas-container">
                    <canvas id="map-canvas" width="300" height="300" />
                </div>
                <p id="current_coord" style="width: 100%; text-align: center">---</p>
                <div class="inline-gallery-container">
                    <h:graphicImage value="#{resource['img/money-6732_256.gif']}" width="150" />
                    <h:graphicImage value="#{resource['img/american-run.gif']}" width="150" />
                </div>
            </div>
            <div class="form-container">
                <h1>Control unit</h1>
                <div class="control-unit-container" id="control-unit-div">
                    <h:form id="control-form" prependId="false">
                        <div class="form-grid">
                            <p:outputLabel for="r-values" value="Выберите R:" />
                            <p:selectManyCheckbox id="r-values" value="#{inputBean.selectedRValues}">
                                <f:selectItem itemLabel="1" itemValue="1"/>
                                <f:selectItem itemLabel="2" itemValue="2"/>
                                <f:selectItem itemLabel="3" itemValue="3"/>
                                <f:selectItem itemLabel="4" itemValue="4"/>
                                <f:selectItem itemLabel="5" itemValue="5"/>
                                <p:ajax listener="#{inputBean.onRChange}" oncomplete="handleRChange(args.selectedRJson)" />
                            </p:selectManyCheckbox>
                            <p:outputLabel for="x-value" value="Выберите X:" />
                            <p:selectOneMenu
                                    id="x-value"
                                    value="#{inputBean.x}"
                                    required="true"
                                    requiredMessage="Выбери хотя бы 1 значение R">
                                <f:selectItem itemLabel="Выберите X" itemValue=""/>
                                <f:selectItem itemLabel="-4" itemValue="-4"/>
                                <f:selectItem itemLabel="-3" itemValue="-3"/>
                                <f:selectItem itemLabel="-2" itemValue="-2"/>
                                <f:selectItem itemLabel="-1" itemValue="-1"/>
                                <f:selectItem itemLabel="0" itemValue="0"/>
                                <f:selectItem itemLabel="1" itemValue="1"/>
                                <f:selectItem itemLabel="2" itemValue="2"/>
                                <f:selectItem itemLabel="3" itemValue="3"/>
                                <f:selectItem itemLabel="4" itemValue="4"/>
                            </p:selectOneMenu>
                            <p:outputLabel for="y-value" value="Введите Y:" />
                            <p:inputNumber
                                    id="y-value"
                                    value="#{inputBean.y}"
                                    required="true"
                                    placeholder="Число от -5 до 3 не включительно..."
                                    requiredMessage="Y не может быть пустым"
                                    decimalPlaces="5"
                                    decimalSeparator="."
                                    inputStyle="width: 100%">
                                <f:validator validatorId="yRangeValidator" />
                            </p:inputNumber>
                        </div>
                        <div class="row-container" style="margin: 1rem 0">
                            <p:commandButton
                                    value="Очистить"
                                    actionListener="#{inputBean.clear}"
                                    process="@this"
                                    update="control-form"
                                    styleClass="form-button"
                                    oncomplete="refreshCanvas();" />
                            <p:commandButton
                                    value="Проверить"
                                    actionListener="#{inputBean.check}"
                                    process="@form"
                                    update="control-form response-table growl"
                                    styleClass="ui-button-success form-button"
                                    onclick="if (!validateForm()) return false;" />
                        </div>
                    </h:form>

                    <p:growl id="growl" showDetail="true" />

                    <div id="table-h" class="inline-gallery-container" style="margin-top: 20px;">
                        <h:graphicImage value="#{resource['img/radioactive-19946_256.gif']}" width="50" />
                        <h1>Results</h1>
                        <h:graphicImage value="#{resource['img/radioactive-19946_256.gif']}" width="50" />
                    </div>

                    <p:dataTable
                            id="response-table"
                            value="#{inputBean.reversedPoints}"
                            var="point"
                            styleClass="custom-table"
                            responsiveLayout="scroll"
                            scrollable="true"
                            scrollHeight="300px">
                        <p:column headerText="x">
                            <h:outputText value="#{point.x}" />
                        </p:column>
                        <p:column headerText="y">
                            <h:outputText value="#{point.y}" />
                        </p:column>
                        <p:column headerText="r">
                            <h:outputText value="#{point.r}" />
                        </p:column>
                        <p:column headerText="hit">
                            <h:outputText value="#{point.hit}" />
                        </p:column>
                        <p:column headerText="temp">
                            <h:outputText value="#{point.temperature}" />
                        </p:column>
                    </p:dataTable>

                </div>
            </div>
        </div>
    </ui:define>

    <ui:define name="scripts">
        <h:outputScript>
            const errorImageSrc = '#{resource['img/danger-18465_256.gif']}'
        </h:outputScript>

        <h:outputScript library="script" name="map-canvas.js" />
        <h:outputScript library="script" name="form.js" />

    </ui:define>

</ui:composition>